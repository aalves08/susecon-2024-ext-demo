(("undefined"!==typeof self?self:this)["webpackJsonpkubecost_0_1_0"]=("undefined"!==typeof self?self:this)["webpackJsonpkubecost_0_1_0"]||[]).push([[1],{"3b48":function(t,e,a){var s=a("cf53");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var r=a("0ed3").default;r("61031d48",s,!0,{sourceMap:!1,shadowMode:!1})},"5be0":function(t,e,a){"use strict";a("a4fe")},"5e1b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main"},[t.$fetchState.pending?e("Loading",{attrs:{mode:"relative"}}):e("div",{staticClass:"main-content"},[e("h3",{staticClass:"mb-40"},[t._v(" "+t._s(t.t("kubecost.title"))+" ")]),t.info?e("h4",{class:"text-"+t.info.type},[t._v(" "+t._s(t.info.msg)+" ")]):e("div",{staticClass:"label-values"},t._l(t.costs,(function(t){return e("LabelValue",{key:t.name,staticClass:"label-value",attrs:{name:t.name,value:t.value}})})),1),t.costs.length?e("PieChart",{key:t.key,attrs:{costs:t.costs}}):t._e()],1)],1)},r=[],o=a("15ca"),n=a("8133"),c=a("9ce4"),i=a("907c");async function l(t){if(t.$store.getters["cluster/canList"](i["a"].APP)){const e=await t.$store.dispatch("cluster/findAll",{type:i["a"].APP})||[],a=e.find(t=>t.id.includes("kubecost"));return a}return null}async function u(t){var e;const a=await l(t.ctx);if(!a)return{type:"error",msg:t.ctx.t("kubecost.appNotInstalled")};const s=t.targetNamespace,r="/k8s/clusters/"+t.clusterId,o=(null===(e=a.metadata)||void 0===e?void 0:e.namespace)||"kubecost",n="http:kubecost-cost-analyzer:9090",c=`model/allocation?window=${t.window||"1d"}&aggregate=${t.aggregate||"namespace"}&accumulate=true&chartType=costovertime&costUnit=cumulative&external=false&filter=&idle=true&idleByNode=false&includeSharedCostBreakdown=false&shareCost=0&shareIdle=false&shareLabels=&shareNamespaces=&shareSplit=weighted&shareTenancyCosts=false`,i=`${r}/api/v1/namespaces/${o}/services/${n}/proxy/${c}`;try{const e=await t.ctx.$store.dispatch("cluster/request",{url:i,redirectUnauthorized:!1});if(200===e.code){var u;const a=null===(u=e.data)||void 0===u?void 0:u[0],r=a?a[s||"cluster-one"]:null;if(a&&r){const e={cpuCost:r.cpuCost.toFixed(2),ramCost:r.ramCost.toFixed(2),pvCost:r.pvCost.toFixed(2),gpuCost:r.gpuCost.toFixed(2),networkCost:r.networkCost.toFixed(2),lbCost:r.loadBalancerCost.toFixed(2),totalCost:r.totalCost.toFixed(2)},a=Object.entries(e).map(([e,a])=>({name:t.ctx.t("kubecost.costs."+e),value:"$"+a,rawValue:a}));return a}return{type:"info",msg:t.ctx.t("kubecost.noDataAvailable")}}}catch(d){return{type:"error",msg:d.message}}return{type:"error",msg:t.ctx.t("kubecost.unknownError")}}var d=function(){var t=this,e=t._self._c;return e("Pie",{staticClass:"custom-pie-chart",attrs:{"chart-options":t.chartOptions,"chart-data":t.chartData,"chart-id":t.chartId,"dataset-id-key":t.datasetIdKey,plugins:t.plugins,"css-classes":t.cssClasses,styles:t.styles,width:t.width,height:t.height}})},p=[],f=a("049f"),h=a("0ac3");h["e"].register(h["m"],h["n"],h["g"],h["a"],h["d"]);var g={name:"PieChart",components:{Pie:f["a"]},props:{labels:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},backgroundColor:{type:Array,default:()=>[]},costs:{type:Array,default:()=>[]},chartId:{type:String,default:"pie-chart"},datasetIdKey:{type:String,default:"label"},width:{type:Number,default:400},height:{type:Number,default:400},cssClasses:{default:"",type:String},styles:{type:Object,default:()=>{}},plugins:{type:Array,default:()=>[]}},computed:{chartData(){let t,e;const a=["#FF0000","#00FF00","#0000FF","#FFA500","#FFFF00","#4B0082"];return this.costs.length&&(t=this.costs.filter(t=>"Total"!==t.name).map(t=>t.name),e=this.costs.filter(t=>"Total"!==t.name).map(t=>t.rawValue)),{labels:t,datasets:[{backgroundColor:a,data:e}]}}},data(){return{chartOptions:{responsive:!0,maintainAspectRatio:!1}}}},m=g,y=(a("e3f7"),a("d802")),v=Object(y["a"])(m,d,p,!1,null,"3f8d5dad",null),b=v.exports,C={name:"RunningCosts",components:{Loading:o["a"],LabelValue:n["a"],PieChart:b},props:{resource:{type:Object,required:!0}},async fetch(){"Cluster"===this.resource.kind?this.costs=await u({aggregate:"cluster",window:"month",clusterId:this.clusterId,ctx:this}):this.costs=await u({aggregate:"namespace",window:"month",targetNamespace:this.resource.id,clusterId:this.clusterId,ctx:this})},watch:{$route:{handler(t){t.hash&&t.hash.includes("#Kubecost")&&(this.key=this.generateString(10))},deep:!0}},data(){return{costs:void 0,key:this.generateString(10)}},computed:{...Object(c["a"])(["clusterId"]),info(){var t,e;return null!==(t=this.costs)&&void 0!==t&&t.type&&null!==(e=this.costs)&&void 0!==e&&e.msg?this.costs:null}},methods:{generateString(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let a=" ";const s=e.length;for(let r=0;r<t;r++)a+=e.charAt(Math.floor(Math.random()*s));return a}}},x=C,w=(a("5be0"),Object(y["a"])(x,s,r,!1,null,"61885f50",null));e["default"]=w.exports},"9f42":function(t,e,a){var s=a("5eaa");e=s(!1),e.push([t.i,".main-content[data-v-61885f50]{display:flex;align-items:center;justify-content:center;flex-direction:column}.main-content h3[data-v-61885f50]{text-align:center}.main-content .label-values[data-v-61885f50]{display:flex;flex-direction:row}.main-content .label-values .label-value[data-v-61885f50]{padding-right:20px}",""]),t.exports=e},a4fe:function(t,e,a){var s=a("9f42");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var r=a("0ed3").default;r("4d1f5904",s,!0,{sourceMap:!1,shadowMode:!1})},cf53:function(t,e,a){var s=a("5eaa");e=s(!1),e.push([t.i,".custom-pie-chart[data-v-3f8d5dad]{margin-top:40px}",""]),t.exports=e},e3f7:function(t,e,a){"use strict";a("3b48")}}]);
//# sourceMappingURL=kubecost-0.1.0.umd.min.1.js.map